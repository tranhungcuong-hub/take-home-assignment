-- Stored procedure for managing blog posts and comments
DELIMITER //

CREATE PROCEDURE ManageBlogPosts(
    IN operation_mode VARCHAR(20), -- Operation mode: 'add', 'retrieve', 'update', 'delete', etc.
    IN post_id INT,
    IN post_title VARCHAR(255),
    IN post_content TEXT,
    IN user_id INT,
    IN comment_id INT,
    IN comment_text TEXT 
)
BEGIN
    -- Add new post
    IF operation_mode = 'add' THEN
        INSERT INTO posts (title, content, user_id) VALUES (post_title, post_content, user_id);

    -- Retrieve post details
    ELSEIF operation_mode = 'retrieve' THEN
        SELECT * FROM posts WHERE id = post_id;

    -- Update post
    ELSEIF operation_mode = 'update' THEN
        UPDATE posts SET title = post_title, content = post_content WHERE id = post_id;

    -- Delete post
    ELSEIF operation_mode = 'delete' THEN
        DELETE FROM posts WHERE id = post_id;

    -- Add comment to a post
    ELSEIF operation_mode = 'add_comment' THEN
        INSERT INTO comments (post_id, user_id, text) VALUES (post_id, user_id, comment_text);

    -- Update comment
    ELSEIF operation_mode = 'update_comment' THEN
        UPDATE comments SET text = comment_text WHERE id = comment_id;

    -- Delete comment
    ELSEIF operation_mode = 'delete_comment' THEN
        DELETE FROM comments WHERE id = comment_id;

    -- Fetch post-related data (e.g., post and comments)
    ELSEIF operation_mode = 'fetch_related_data' THEN
        SELECT p.*, c.* FROM posts p
        LEFT JOIN comments c ON p.id = c.post_id
        WHERE p.id = post_id;

    END IF;
END //

DELIMITER ;
